{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-5">
    <h2>Modify Ride</h2>

    <!-- Display messages (Success/Error) -->
    {% if messages %}
        {% for message in messages %}
            <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-danger{% endif %}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="row">
        <!-- Ride Edit Form -->
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <form method="post" id="rideEditForm">
                        {% csrf_token %}

                        <!-- Address Fields -->
                        <div class="form-group">
                            <label for="id_pickup_location">Pickup Location</label>
                            <input type="text" id="id_pickup_location" name="pickup_location" class="form-control" value="{{ ride.pickup_location }}" required>
                        </div>

                        <div class="form-group">
                            <label for="id_dropoff_location">Dropoff Location</label>
                            <input type="text" id="id_dropoff_location" name="dropoff_location" class="form-control" value="{{ ride.dropoff_location }}" required>
                        </div>

                        <!-- Button to Fetch Estimated Time & Route -->
                        <button type="button" class="btn btn-info mt-2" id="getETAButton">Get Estimated Time</button>

                        <!-- Estimated Arrival Time Display -->
                        <div id="etaDisplay" class="mt-3 text-info" style="display: none;">
                            <strong>Estimated Travel Time:</strong> <span id="etaValue"></span>
                        </div>

                        <!-- Required Arrival Time Field -->
                        <div class="form-group mt-3">
                            <label for="required_arrival_time">Required Arrival Time:</label>
                            <input type="datetime-local" id="required_arrival_time" name="required_arrival_time" class="form-control" value="{{ ride.required_arrival_time|date:'Y-m-d\TH:i' }}">
                        </div>

                        {{ form.passenger_count|as_crispy_field }}
                        {{ form.special_request|as_crispy_field }}
                        {{ form.allow_sharing|as_crispy_field }}

                        <button type="submit" class="btn btn-primary">Save Changes</button>
                        <a href="{% url 'rider_dashboard' %}" class="btn btn-secondary">Cancel</a>
                    </form>
                </div>
            </div>
        </div>

        <!-- Map Display -->
        <div class="col-md-6">
            <div id="map" style="width: 100%; height: 400px; border-radius: 10px;"></div>
        </div>
    </div>
</div>

<!-- Load Google Maps API -->
<script async defer src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&libraries=places&callback=initMap"></script>

{% endblock %}